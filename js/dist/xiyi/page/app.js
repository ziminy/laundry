/*2015-01-29 16:50:06 */
define("xiyi/page/app",["../common/ado","../common/numberOperation","../tpl/userList","../tpl/addUser","../tpl/addActProduct","../tpl/billList","../tpl/clothesList","../tpl/cardList"],function(a){function b(){c.select({tname:"user",conditions:["user.a_id="+e]},function(a){d.html("\u4f1a\u5458\u6570\uff1a"+a.dataList.length+"\u4eba")})}a("../common/ado");var c=new ado,d=$(".js-panel-body"),e=$(".js-aid").val();a("../common/numberOperation"),a("../tpl/userList"),a("../tpl/addUser"),a("../tpl/addActProduct"),a("../tpl/billList"),a("../tpl/clothesList"),a("../tpl/cardList");var f=new userListobj,g=new addUserobj,h=new addActProductObj,i=new billListobj,j=new clothesListobj,k=new cardListobj;b(),$('[data-type="adduser"]').click(function(){g.init()}),$('[data-type="showuserlist"]').click(function(){f.init()}),$('[data-type="addactproduct"]').click(function(){h.init()}),$('[data-type="showbilllist"]').click(function(){i.init()}),$('[data-type="clothescontrol"]').click(function(){j.init()}),$('[data-type="cardcontrol"]').click(function(){k.init()}),d.on("dblclick",".js-userlist tr",function(){var a=$(this),b=$(".bs-operationpanel"),e=a.find(".js-aid").val(),g=$(".js-totalc"),h=$(".js-balance");d.find(".js-operationbtn").trigger("click");var i=0,j=0;b.find("h4").html("\u4f1a\u5458\uff1a"+a.find(".js-uname").val()),g.add(h).html(""),c.select({tname:"bill,user",conditions:["user.u_id="+e,"user.u_id=bill.u_id"]},function(a){if(a.dataList.length){for(var b=0;b<a.dataList.length;b++)i=parseFloat(i).add(a.dataList[b].bill_paid);j=a.dataList[0].u_balance,g.html(i+" \u5143"),h.html(j+" \u5143")}}),b.find(".js-deleteuser").click(function(){confirm("\u786e\u5b9a\u8981\u5220\u9664\u8be5\u4f1a\u5458\u5417\uff1f")&&c.remove({tname:"user",idname:"u_id",ids:e},function(){b.find(".close").trigger("click"),$(".modal-backdrop").removeClass("in").addClass("out").hide(),f.init()})})}),d.on("click",".js-deletebill",function(){var a=$(this).parent().parent(),b=a.find(".js-billid").val(),d=a.find(".js-userid").val();confirm("\u5220\u9664\u540e\u8be5\u91d1\u989d\u4f1a\u8fd4\u56de\u5230\u4f1a\u5458\u4f59\u989d\uff0c\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f")&&c.select({tname:"bill,user",conditions:["bill_id="+b,"user.u_id=bill.u_id"]},function(a){var e=a.dataList[0].bill_paid,f=a.dataList[0].u_balance;c.update({tname:"user",idname:"u_id",delid:d,tfield:"u_balance",u_balance:Number(f).add(e)},function(){c.remove({tname:"bill",idname:"bill_id",ids:b},function(){c.remove({tname:"actproduct",idname:"bill_id",ids:b},function(){i.init()})})})})}),d.on("click",".js-billlist .js-showinfo",function(){var a=$(this).parent().parent(),b=a.find(".js-billid").val(),d=$(".js-actproductlist tbody");$(".js-operationbtn").trigger("click"),c.select({tname:"actproduct",conditions:["bill_id="+b]},function(a){var b=a.dataList.length;if(d.html(""),b>0)for(var c=0;b>c;c++)d.append('<tr><input class="js-apid" value="'+a.dataList[c].ap_id+'" type="hidden" /><td>'+a.dataList[c].ap_name+"</td><td>"+a.dataList[c].ap_price+"</td><td>"+a.dataList[c].ap_color+"</td><td>"+a.dataList[c].ap_brand+"</td><td>"+a.dataList[c].ap_st+"</td><td>"+a.dataList[c].ap_defect+"</td><td>"+a.dataList[c].ap_washingef+"</td><td>"+a.dataList[c].ap_remarks+"</td></tr>")})}),d.on("click",".js-billlist .js-checkout",function(){var a=$(this).parent().parent(),b=a.find(".js-billid").val(),d=a.find(".js-userid").val();$(".js-actproductlist tbody");var e=a.find(".js-closingdate").html(),f=a.find(".js-ubalance").val(),g=a.find(".js-billpaid").html(),h=(new Date).Format("yyyy-MM-dd hh:mm:ss");return"\u672a\u7ed3\u8d26"!=e?(alert("\u672c\u9500\u552e\u5355\u5df2\u7ecf\u7ed3\u8fc7\u8d26\u4e86\uff01"),void 0):(confirm("\u786e\u5b9a\u8981\u7ed3\u8d26\u5417\uff1f")&&c.update({tname:"bill",idname:"bill_id",delid:b,tfield:"bill_closingdate",bill_closingdate:h},function(){c.update({tname:"user",idname:"u_id",delid:d,tfield:"u_balance",u_balance:Number(f).sub(g)},function(){i.init()})}),void 0)}),d.on("click",".js-billlist .js-billstate",function(){var a=$(this).parent().parent(),b=a.find(".js-billid").val();$(".js-actproductlist tbody");var d=$(this),e=$(this).html(),f=a.find("td").eq(2).html();return e="\u672a\u53d6\u8863"===e?"\u5df2\u53d6\u8863"+(new Date).Format("yyyy-MM-dd hh:mm:ss"):"\u672a\u53d6\u8863","\u672a\u7ed3\u8d26"===f?(alert("\u8bf7\u7ed3\u8d26\u540e\u518d\u66f4\u6539\u72b6\u6001\uff01"),void 0):(confirm("\u786e\u5b9a\u8981\u66f4\u6539\u72b6\u6001\u5417\uff1f")&&c.update({tname:"bill",idname:"bill_id",delid:b,tfield:"bill_state",bill_state:e},function(){d.html(e)}),void 0)}),d.on("click","a",function(){function a(){var a=d.find("#search").val(),b=$(".js-userlist tbody");if(""===a)return d.find("#search").focus().parent().addClass("has-error"),void 0;d.find("#search").parent().removeClass("has-error");var f={};c.select({tname:"cardtype",conditions:["a_id="+$(".js-aid").val()]},function(d){f=d.dataList,c.select({tname:"user,cardtype",conditions:["user.a_id="+e,"cardtype.cardtype_id=user.cardtype_id",'u_phone like "%'+a+'%"']},function(a){var c=a.dataList.length;if(c>0){b.html(""),$(".js-loadmore").hide();for(var d=0;d<a.dataList.length;d++){var e=a.dataList[d].cardtype_id;b.append('<tr><input class="js-aid" value="'+a.dataList[d].u_id+'" type="hidden" />'+'<td><input class="js-ucard" value="'+a.dataList[d].u_card+'" type="text" /></td>'+'<td><input class="js-uname" value="'+a.dataList[d].u_name+'" type="text" /></td>'+'<td><input class="js-uphone" value="'+a.dataList[d].u_phone+'" type="text" /></td>'+'<td><select class="cardtype" class="form-control"></select>'+a.dataList[d].cardtype_name+"\uff08\u6298\u6263\u7387\uff1a"+a.dataList[d].cardtype_discount+"\uff09</td>"+'<td class="js-ubalance">'+a.dataList[d].u_balance+"</td>"+"<td>"+a.dataList[d].u_signdate+"</td>"+'<td><input class="js-uremarks" value="'+(a.dataList[d].u_remarks?a.dataList[d].u_remarks:"")+'" type="text" /></td>'+'<td><a class="btn btn-info js-recharge">\u5145\u503c</a> <a class="btn btn-danger js-doupdate">\u4fee\u6539</a></td></tr>');for(var g=0;g<f.length;g++)b.find(".cardtype").eq(d).append('<option value="'+f[g].cardtype_id+'">'+f[g].cardtype_name+"</option>");b.find(".cardtype").eq(d).val(e)}}})})}function b(){var a=d.find("#search").val(),b=$(".js-billlist tbody"),f="";return""===a?(d.find("#search").focus().parent().addClass("has-error"),void 0):(d.find("#search").parent().removeClass("has-error"),f=/^\d{4,11}$/.test(a)?11===a.length?"user.u_phone="+a:"bill.bill_name='"+a+"'":"user.u_name='"+a+"'",c.select({tname:"user,bill",conditions:["user.a_id="+e,"bill.u_id=user.u_id",f]},function(a){var c=a.dataList.length;if(c>0){b.html(""),$(".js-loadmore").hide();for(var d=0;d<a.dataList.length;d++)b.append('<tr><input class="js-billid" value="'+a.dataList[d].bill_id+'" type="hidden" /><td>'+a.dataList[d].bill_name+"</td><td>"+a.dataList[d].bill_createdate+"</td><td>"+a.dataList[d].bill_closingdate+"</td><td>"+a.dataList[d].bill_paid+"</td><td>"+a.dataList[d].u_name+'</td><td><a class="btn btn-default js-billstate">'+a.dataList[d].bill_state+'</a></td><td><a class="btn btn-warning js-checkout">\u7ed3\u8d26</a> <a class="btn btn-info js-showinfo">\u8be6\u60c5</a> <a class="btn btn-danger js-deletebill">\u5220\u9664</a></td></tr>')}else alert("\u6ca1\u6709\u641c\u5230\u7ed3\u679c")}),void 0)}function f(){var a=d.find("#cardTypeName").val(),b=d.find("#cardTypeDiscount").val();return""===a?(d.find("#cardTypeName").focus().parent().addClass("has-error"),void 0):(d.find("#cardTypeName").parent().removeClass("has-error"),b=""==b?1:b,c.insert({tname:"cardtype",tfield:"cardtype_name,cardtype_discount,a_id",cardtype_name:a,a_id:e,cardtype_discount:b},function(){d.find(".bs-cardtype").modal("hide"),c.select({tname:"cardtype",conditions:["a_id="+e]},function(a){d.find("#cardtype").html("");for(var b=0;b<a.dataList.length;b++)d.find("#cardtype").append('<option value="'+a.dataList[b].cardtype_id+'">'+a.dataList[b].cardtype_name+"</option>")})}),void 0)}function g(){var a=d.find("#username").val(),b=d.find("#uphone").val(),f=d.find("#cardtype").val(),g=d.find("#ubalance").val(),h=d.find("#sex").val(),i=d.find("#ubirth").val(),j=d.find("#ucard").val(),k=d.find("#usigndate").val();return""===a?(d.find("#username").focus().parent().addClass("has-error"),void 0):(d.find("#username").parent().removeClass("has-error"),""===b?(d.find("#uphone").focus().parent().addClass("has-error"),void 0):RegExp.isPhone(b)?(d.find("#uphone").parent().removeClass("has-error"),g=""==g?0:g,c.insert({tname:"user",tfield:"u_name,u_phone,u_card,u_sex,u_birth,u_signdate,u_balance,cardtype_id,a_id",u_name:a,u_card:j,cardtype_id:f,u_balance:g,u_signdate:k,u_sex:h,a_id:e,u_birth:i,u_phone:b},function(){d.find(".js-alertbtn").trigger("click")}),void 0):(d.find("#uphone").focus().parent().addClass("has-error"),void 0))}var h=$(this),i=h.data("fname");switch(i){case"addUserBtn":g();break;case"addCardType":f();break;case"selectUser":a();break;case"selectBill":b()}}),RegExp.isPhone=function(a){var b=/^1[3|4|5|8]\d{9}$/;return b.test(a)}}),define("xiyi/common/ado",[],function(a,b){ado=function(a){a=$.extend({"interface":"api/"},a),this.options=a},ado.prototype={select:function(a,b){$.ajax({url:this.options.interface+"getdata.php",dataType:"json",data:a,cache:!1,success:function(a){b?b(a):""}})},insert:function(a,b){$.ajax({url:this.options.interface+"insert.php",dataType:"json",data:a,cache:!1,complete:function(a){b?b(a):""}})},remove:function(a,b){$.ajax({url:this.options.interface+"delete.php",dataType:"json",data:a,cache:!1,complete:function(a){b?b(a):""}})},update:function(a,b){$.ajax({url:this.options.interface+"update.php",dataType:"json",data:a,cache:!1,complete:function(a){b?b(a):""}})}},b.ado=ado}),define("xiyi/common/numberOperation",[],function(require,exports,module){function accAdd(a,b){var c,d,e,f;try{c=a.toString().split(".")[1].length}catch(g){c=0}try{d=b.toString().split(".")[1].length}catch(g){d=0}if(f=Math.abs(c-d),e=Math.pow(10,Math.max(c,d)),f>0){var h=Math.pow(10,f);c>d?(a=Number(a.toString().replace(".","")),b=Number(b.toString().replace(".",""))*h):(a=Number(a.toString().replace(".",""))*h,b=Number(b.toString().replace(".","")))}else a=Number(a.toString().replace(".","")),b=Number(b.toString().replace(".",""));return(a+b)/e}function accSub(a,b){var c,d,e,f;try{c=a.toString().split(".")[1].length}catch(g){c=0}try{d=b.toString().split(".")[1].length}catch(g){d=0}return e=Math.pow(10,Math.max(c,d)),f=c>=d?c:d,((a*e-b*e)/e).toFixed(f)}function accMul(a,b){var c=0,d=a.toString(),e=b.toString();try{c+=d.split(".")[1].length}catch(f){}try{c+=e.split(".")[1].length}catch(f){}return Number(d.replace(".",""))*Number(e.replace(".",""))/Math.pow(10,c)}function accDiv(arg1,arg2){var r1,r2,t1=0,t2=0;try{t1=arg1.toString().split(".")[1].length}catch(e){}try{t2=arg2.toString().split(".")[1].length}catch(e){}with(Math)return r1=Number(arg1.toString().replace(".","")),r2=Number(arg2.toString().replace(".","")),r1/r2*pow(10,t2-t1)}Number.prototype.add=function(a){return accAdd(a,this)},Number.prototype.sub=function(a){return accSub(this,a)},Number.prototype.mul=function(a){return accMul(a,this)},Number.prototype.div=function(a){return accDiv(this,a)}}),define("xiyi/tpl/userList",[],function(a,b){userListobj=function(){this.userListHtml='<div class="col-sm-6">                            <div class="col-sm-4">                              <input type="text" class="form-control" id="search" placeholder="\u8bf7\u8f93\u5165\u4f1a\u5458\u8054\u7cfb\u7535\u8bdd">                            </div>                            <div class=" col-sm-2">                              <a data-fname="selectUser" class="btn btn-success">\u641c\u7d22</a>                            </div>                        </div>                        <table class="table table-striped table-hover js-userlist">                        <thead>                          <tr>                            <th>\u5361\u53f7</th>                            <th>\u59d3\u540d</th>                            <th>\u624b\u673a\u53f7</th>                            <th>\u5361\u7c7b\u578b</th>                            <th>\u5361\u4f59\u989d</th>                            <th>\u5f00\u5361\u65e5\u671f</th>                            <th>\u5907\u6ce8</th>                            <th>\u64cd\u4f5c</th>                          </tr>                        </thead>                        <tbody></tbody>                        </table>                        <input class="js-operationbtn" data-target=".bs-operationpanel" data-toggle="modal" type="hidden" />                        <div class="modal fade bs-operationpanel" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">                        <div class="modal-dialog modal-sm">                          <div class="modal-content">                              <div class="modal-header">                                <button data-dismiss="modal" class="close" type="button"><span aria-hidden="true">\xd7</span><span class="sr-only">Close</span></button>                                <h4 id="mySmallModalLabel" class="modal-title">\u63d0\u793a</h4>                              </div>                              <div class="modal-body js-content">                                <p class="bg-primary" style="padding-left:4px">                                    <label style="margin-top:5px" class="control-label">\u603b\u6d88\u8d39\uff1a</label>                                    <label style="margin-top:5px" class="control-label js-totalc"></label>                                </p>                                <p class="bg-danger text-success" style="padding-left:4px">                                    <label style="margin-top:5px" class="control-label">\u4f59&nbsp;&nbsp;&nbsp;&nbsp;\u989d\uff1a</label>                                    <label style="margin-top:5px" class="control-label js-balance"></label>                                </p>                                <a class="btn btn-danger col-sm-offset-4 js-deleteuser">\u5220\u9664\u4f1a\u5458</a>                              </div>                            </div>                        </div>                      </div>                      <a data-start="0" data-count="10" class="js-loadmore btn btn-success col-sm-offset-5">\u52a0\u8f7d\u66f4\u591a</a>',this.$panelbody=$(".js-panel-body"),this.aid=$(".js-aid").val(),this.ADO=new ado,this.cardtypeList={}},userListobj.prototype={init:function(){var a=this;this.$panelbody.html(this.userListHtml),this.$userlist=$(".js-userlist tbody"),this.$loadmore=$(".js-loadmore"),this.pageCount=parseInt(this.$loadmore.data("count")),a.ADO.select({tname:"cardtype",conditions:["a_id="+$(".js-aid").val()]},function(b){a.cardtypeList=b.dataList,a.showUserList(a.getLimit())}),a.$loadmore.click(function(){a.showUserList(a.getLimit())}),a.$panelbody.on("click",".js-doupdate",function(){var b=$(this).parent().parent(),c=b.find(".js-ucard").val(),d=b.find(".js-aid").val(),e=b.find(".js-uname").val(),f=b.find(".js-uphone").val(),g=b.find(".cardtype").val(),h=b.find(".js-uremarks").val();confirm("\u786e\u5b9a\u8981\u4fee\u6539\u5417\uff1f")&&a.ADO.update({tname:"user",idname:"u_id",delid:d,tfield:"u_name,u_phone,u_card,cardtype_id,u_remarks",u_name:e,u_phone:f,u_card:c,u_remarks:h,cardtype_id:g},function(){alert("\u4fee\u6539\u6210\u529f")})}),a.$panelbody.on("click",".js-recharge",function(){var b=$(this).parent().parent(),c=b.find(".js-uname").val(),d=b.find(".js-aid").val(),e=b.find(".js-ubalance").html(),f=window.prompt("\u8bf7\u8f93\u5165\u91d1\u989d\uff08\u5143\uff09","");""!=f?confirm("\u786e\u5b9a\u8981\u4e3a\u201c"+c+"\u201d\u5145\u503c"+f+"\u5143\u5417\uff1f")&&a.ADO.update({tname:"user",idname:"u_id",delid:d,tfield:"u_balance",u_balance:parseFloat(e).add(f)},function(){alert("\u5145\u503c\u6210\u529f"),b.find(".js-ubalance").html(parseFloat(e).add(f).toFixed(2))}):alert("\u8bf7\u8f93\u5165\u6b63\u786e\u91d1\u989d\uff01")})},getLimit:function(){return this.$loadmore.data("start")+","+this.$loadmore.data("count")},showUserList:function(a){var b=this;b.$loadmore.html("\u52a0\u8f7d\u66f4\u591a..."),b.ADO.select({tname:"user,cardtype",conditions:["user.a_id="+b.aid,"cardtype.cardtype_id=user.cardtype_id"],limit:a},function(a){for(var c=a.dataList.length,d=0;c>d;d++){a.dataList[d].cardtype_name;var e=a.dataList[d].cardtype_id;a.dataList[d].cardtype_discount;var f=a.dataList[d].u_balance;parseFloat(a.dataList[d].u_balance)<0&&(f='<b style="color:red">'+a.dataList[d].u_balance+"</b>"),b.$userlist.append('<tr><input class="js-aid" value="'+a.dataList[d].u_id+'" type="hidden" />'+'<td><input class="js-ucard" value="'+a.dataList[d].u_card+'" type="text" /></td>'+'<td><input class="js-uname" value="'+a.dataList[d].u_name+'" type="text" /></td>'+'<td><input class="js-uphone" value="'+a.dataList[d].u_phone+'" type="text" /></td>'+'<td><select class="cardtype" class="form-control"></select>'+a.dataList[d].cardtype_name+"\uff08\u6298\u6263\u7387\uff1a"+a.dataList[d].cardtype_discount+"\uff09</td>"+'<td class="js-ubalance">'+f+"</td>"+"<td>"+a.dataList[d].u_signdate+"</td>"+'<td><input class="js-uremarks" value="'+(a.dataList[d].u_remarks?a.dataList[d].u_remarks:"")+'" type="text" /></td>'+'<td><a class="btn btn-info js-recharge">\u5145\u503c</a> <a class="btn btn-danger js-doupdate">\u4fee\u6539</a></td></tr>');for(var g=0;g<b.cardtypeList.length;g++)b.$userlist.find(".cardtype").eq(d).append('<option value="'+b.cardtypeList[g].cardtype_id+'">'+b.cardtypeList[g].cardtype_name+"</option>");b.$userlist.find(".cardtype").eq(d).val(e)}c==b.pageCount?b.$loadmore.data("start",parseInt(b.$loadmore.data("count"))+parseInt(b.$loadmore.data("start"))):b.$loadmore.hide(),b.$loadmore.html("\u52a0\u8f7d\u66f4\u591a")})}},b.userListobj=userListobj}),define("xiyi/tpl/addUser",[],function(a,b){addUserobj=function(){this.addUserHtml='<div class="addnewuser">                <form class="form-horizontal" role="form">                    <div class="form-group">                        <div class="col-sm-6">                            <label class="col-sm-2 control-label">\u59d3\u540d\uff1a</label>                            <div class="col-sm-4">                              <input type="text" class="form-control" id="username" placeholder="\u4f1a\u5458\u59d3\u540d">                              <span class="glyphicon form-control-feedback">*</span>                            </div>                        </div>                        <div class="col-sm-6">                            <label class="col-sm-2 control-label">\u6027\u522b\uff1a</label>                            <div class="col-sm-4">                                <select id="sex" class="form-control">                                  <option>\u7537</option>                                  <option>\u5973</option>                                </select>                            </div>                        </div>                    </div>                    <div class="form-group">                        <div class="col-sm-6">                            <label class="col-sm-2 control-label">\u7535\u8bdd\uff1a</label>                            <div class="col-sm-4">                              <input type="text" class="form-control" id="uphone" placeholder="\u8054\u7cfb\u7535\u8bdd">                              <span class="glyphicon form-control-feedback">*</span>                            </div>                        </div>                        <div class="col-sm-6">                            <label class="col-sm-2 control-label">\u751f\u65e5\uff1a</label>                            <div class="col-sm-4">                              <input type="text" class="form-control" id="ubirth" placeholder="\u51fa\u751f\u65e5\u671f">                            </div>                        </div>                    </div>                    <div class="form-group">                        <div class="col-sm-6">                            <label class="col-sm-2 control-label">\u5361\u7c7b\u578b\uff1a</label>                            <div class="col-sm-3">                                <select id="cardtype" class="form-control">                                </select>                            </div>                            <div class="col-sm-1">                                <a data-target=".bs-cardtype" data-toggle="modal" class="btn btn-default">+\u7c7b\u578b</a>                            </div>                        </div>                        <div class="col-sm-6">                            <label class="col-sm-2 control-label">\u5361\u53f7\uff1a</label>                            <div class="col-sm-4">                              <input type="text" class="form-control" id="ucard" placeholder="\u4f1a\u5458\u5361\u53f7">                            </div>                        </div>                    </div>                    <div class="form-group">                        <div class="col-sm-6">                            <label class="col-sm-2 control-label">\u5b9e\u6536\uff1a</label>                            <div class="col-sm-4">                              <input type="text" class="form-control" id="ubalance" placeholder="\u5b9e\u6536\u91d1\u989d">                            </div>                        </div>                        <div class="col-sm-6">                            <label class="col-sm-2 control-label">\u65e5\u671f\uff1a</label>                            <div class="col-sm-4">                              <input type="text" class="form-control" id="usigndate" placeholder="\u5f00\u5361\u65e5\u671f">                            </div>                        </div>                    </div>                    <div class="form-group text-center">                          <a data-fname="addUserBtn" class="btn btn-danger">\u6dfb&nbsp;&nbsp;\u52a0</a>                          <input class="js-alertbtn" data-target=".bs-alert" data-toggle="modal" type="hidden" />                    </div>                </form>                <div class="modal fade bs-alert" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">      <div class="modal-dialog modal-sm">        <div class="modal-content">            <div class="modal-header">              <button data-dismiss="modal" class="close" type="button"><span aria-hidden="true">\xd7</span><span class="sr-only">Close</span></button>              <h4 id="mySmallModalLabel" class="modal-title">\u63d0\u793a</h4>            </div>            <div class="modal-body js-alert">              \u6dfb\u52a0\u6210\u529f\uff01            </div>          </div>      </div>    </div>    <div class="modal fade bs-cardtype" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">      <div class="modal-dialog modal-sm">        <div class="modal-content">            <div class="modal-header">              <button data-dismiss="modal" class="close" type="button"><span aria-hidden="true">\xd7</span><span class="sr-only">Close</span></button>              <h4 id="mySmallModalLabel" class="modal-title">\u6dfb\u52a0\u5361\u7c7b\u578b</h4>            </div>            <div class="modal-body">                <form class="form-horizontal" role="form">                <div class="form-group">                    <input type="text" class="form-control" id="cardTypeName" placeholder="\u5361\u7c7b\u578b\u540d\u79f0">                </div>                <div class="form-group">                    <input type="number" step="0.01" min="0.01" max="1" class="form-control" id="cardTypeDiscount" placeholder="\u6298\u6263\u7387\uff08\u9ed8\u8ba41\u4e0d\u6253\u6298\uff09">                </div>                <a data-fname="addCardType" class="btn btn-default col-sm-offset-5">\u63d0\u4ea4</a>                </form>            </div>          </div>      </div>    </div>                </div>',this.$panelbody=$(".js-panel-body"),this.ADO=new ado,Date.prototype.Format=function(a){var b={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(a)&&(a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var c in b)new RegExp("("+c+")").test(a)&&(a=a.replace(RegExp.$1,1==RegExp.$1.length?b[c]:("00"+b[c]).substr((""+b[c]).length)));return a}},addUserobj.prototype={init:function(){var a=this;this.$panelbody.html(this.addUserHtml),$("#usigndate").val((new Date).Format("yyyy-MM-dd")),this.ADO.select({tname:"cardtype",conditions:["a_id="+$(".js-aid").val()]},function(b){for(var c=0;c<b.dataList.length;c++)a.$panelbody.find("#cardtype").append('<option value="'+b.dataList[c].cardtype_id+'">'+b.dataList[c].cardtype_name+"</option>")})}},b.addUserobj=addUserobj}),define("xiyi/tpl/addActProduct",[],function(a,b){addActProductObj=function(){this.addActProductHtml='<div class="addnewuser">                <form class="form-horizontal" role="form">                    <div class="form-group">                        <div class="col-sm-6">                            <label class="col-sm-2 control-label">\u9500\u552e\u5355\u53f7\uff1a</label>                            <div class="col-sm-4">                              <input type="text" class="form-control" id="billname" placeholder="\u9500\u552e\u5355\u53f7">                              <span class="glyphicon form-control-feedback hide">*</span>                            </div>                        </div>                        <div class="col-sm-6">                            <label class="col-sm-2 control-label">\u7535\u8bdd\uff1a</label>                            <div class="col-sm-3">                                <input type="text" class="form-control" id="uphone" placeholder="\u8054\u7cfb\u7535\u8bdd">                            </div>                            <div class="col-sm-1">                                <a class="btn btn-info js-getUser">\u63d0\u53d6</a>                            </div>                        </div>                    </div>                    <div class="form-group">                        <div class="col-sm-6">                            <label class="col-sm-2 control-label">\u4f1a\u5458\u59d3\u540d\uff1a</label>                            <div class="col-sm-4">                              <input type="text" disabled="" uid="0" class="form-control" id="username" placeholder="\u4f1a\u5458\u59d3\u540d">                              <span class="glyphicon form-control-feedback hide">*</span>                            </div>                        </div>                        <div class="col-sm-6">                            <label class="col-sm-2 control-label">\u5907\u6ce8\uff1a</label>                            <div class="col-sm-4">                              <input type="text" class="form-control" id="remarks" placeholder="\u5907\u6ce8">                            </div>                        </div>                    </div>                    <div class="form-group">                        <div class="col-sm-6">                            <label class="col-sm-2 control-label">\u6d3b\u54c1\uff1a</label>                            <div class="col-sm-4">                                <a data-target=".bs-cardtype" data-toggle="modal" class="btn btn-warning">\u6dfb\u52a0\u6d3b\u54c1</a>                            </div>                        </div>                        <div class="col-sm-6">                            <label class="col-sm-2 control-label">\u521b\u5efa\u65e5\u671f\uff1a</label>                            <div class="col-sm-4">                              <input type="text" class="form-control" id="createdate" placeholder="\u521b\u5efa\u65e5\u671f">                            </div>                        </div>                    </div>                    <div class="form-group">                        <div class="col-sm-6">                            <label class="col-sm-2 control-label">\u8d39\u7528\uff1a</label>                            <div class="col-sm-3">                              <input type="text" disabled="" class="form-control" id="paid" placeholder="\u603b\u8ba1\u8d39\u7528">                            </div>                            <label class="col-sm-1 control-label">\u5143</label>                        </div>                        <div class="col-sm-6">                            <label class="col-sm-2 control-label">\u7ed3\u8d26\u65e5\u671f\uff1a</label>                            <div class="col-sm-4">                              <input type="text" class="form-control" id="closingdate" placeholder="\u7ed3\u8d26\u65e5\u671f">                            </div>                        </div>                    </div>                    <div class="form-group">                        <div class="col-sm-6">                            <label class="col-sm-2 control-label">\u4f59\u989d(\u5143)\uff1a</label>                            <div class="col-sm-3">                              <span style="padding-top:7px;display:block;" id="balance" balance="0" balanceed="0"></span>                            </div>                            <label class="col-sm-2 control-label">\u6298\u6263\u7387\uff1a</label>                            <div class="col-sm-2">                              <span style="padding-top:7px;display:block;" id="discount"></span>                            </div>                        </div>                    </div>                    <table class="table table-striped table-hover js-ActProductlist">                    <thead>                      <tr>                        <th>\u8863\u7269\u540d\u79f0</th>                        <th>\u91d1\u989d(\u5143)</th>                        <th>\u989c\u8272</th>                        <th>\u8863\u7269\u54c1\u724c</th>                        <th>\u7279\u6b8a\u5904\u7406</th>                        <th>\u7455\u75b5</th>                        <th>\u6d17\u540e\u6548\u679c</th>                        <th>\u5907\u6ce8</th>                        <th>\u64cd\u4f5c</th>                      </tr>                    </thead>                    <tbody></tbody>                    </table>                    <div class="form-group text-center">                          <a data-fname="addBillBtn" class="btn btn-danger">\u63d0\u4ea4\u9500\u552e\u5355</a>                          <input class="js-alertbtn" data-target=".bs-alert" data-toggle="modal" type="hidden" />                    </div>                </form>                <div class="modal fade bs-alert" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">      <div class="modal-dialog modal-sm">        <div class="modal-content">            <div class="modal-header">              <button data-dismiss="modal" class="close" type="button"><span aria-hidden="true">\xd7</span><span class="sr-only">Close</span></button>              <h4 id="mySmallModalLabel" class="modal-title">\u63d0\u793a</h4>            </div>            <div class="modal-body js-alert">              \u63d0\u4ea4\u6210\u529f\uff01            </div>          </div>      </div>    </div>    <div class="modal fade bs-cardtype" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">      <div class="modal-dialog modal-lg">        <div class="modal-content">            <div class="modal-header">              <button data-dismiss="modal" class="close" type="button"><span aria-hidden="true">\xd7</span><span class="sr-only">Close</span></button>              <h4 id="mySmallModalLabel" class="modal-title">\u6dfb\u52a0\u6d3b\u54c1</h4>            </div>            <div class="modal-body">                <table class="table-condensed js-actproductform" style="margin:0 auto">                  <tr>                    <td><select id="clotheslist" class="form-control">                      <option>\u8bf7\u9009\u62e9\u8863\u7269</option>                    </select></td>                    <td><input type="text" class="form-control" id="apname" placeholder="\u8863\u7269\u540d\u79f0"></td>                    <td><input type="text" class="form-control" id="apprice" placeholder="\u91d1\u989d"></td>                    <td><input type="text" class="form-control" id="apcolor" placeholder="\u989c\u8272"></td>                    <td><input type="text" class="form-control" id="apremarks" placeholder="\u5907\u6ce8"></td>                  </tr>                  <tr>                    <td><input type="text" class="form-control" id="apbrand" placeholder="\u8863\u7269\u54c1\u724c"></td>                    <td><input type="text" class="form-control" id="apst" placeholder="\u7279\u6b8a\u5904\u7406"></td>                    <td><input type="text" class="form-control" id="apdefect" placeholder="\u7455\u75b5"></td>                    <td><input type="text" class="form-control" id="apwashingef" placeholder="\u6d17\u540e\u6548\u679c"></td>                    <td><a data-type="0" class="btn btn-default js-washingtype">\u6e7f\u6d17</a></td>                  </tr>                  <tr>                    <td colspan="5"><a data-fname="addActProduct" class="btn btn-success col-sm-offset-5">\u63d0\u4ea4</a></td>                  </tr>                </table>            </div>          </div>      </div>    </div>                </div>',this.$panelbody=$(".js-panel-body"),this.ADO=new ado,Date.prototype.Format=function(a){var b={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};
/(y+)/.test(a)&&(a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var c in b)new RegExp("("+c+")").test(a)&&(a=a.replace(RegExp.$1,1==RegExp.$1.length?b[c]:("00"+b[c]).substr((""+b[c]).length)));return a}},addActProductObj.prototype={init:function(){var a=this;this.$panelbody.html(this.addActProductHtml),$("#closingdate").add("#createdate").val((new Date).Format("yyyy-MM-dd hh:mm:ss")),$("#billname").val((new Date).Format("yyyyMMddhhmmss")),"2"==$(".js-aid").val()&&$("#billname").val("");var b=[],c=$(".js-ActProductlist"),d=0;$("#uphone").focus(),$(".js-getUser").click(function(){try{a.ADO.select({tname:"user,cardtype",conditions:["u_phone="+$("#uphone").val(),"user.cardtype_id=cardtype.cardtype_id","user.a_id="+$(".js-aid").val()]},function(a){a.dataList[0]?($("#username").val(a.dataList[0].u_name),$("#username").attr("uid",a.dataList[0].u_id),$("#balance").html(a.dataList[0].u_balance).attr("balance",a.dataList[0].u_balance),$("#discount").html(a.dataList[0].cardtype_discount),$("#uphone").parent().removeClass("has-error")):$("#uphone").parent().addClass("has-error")})}catch(b){$("#uphone").parent().addClass("has-error")}}),$("#uphone").keyup(function(a){13==a.which&&$(".js-getUser").trigger("click")}),$("#closingdate").focus(function(){$(this).select()}),this.ADO.select({tname:"clothes",conditions:["a_id="+$(".js-aid").val()]},function(a){for(var b=0;b<a.dataList.length;b++)$("#clotheslist").append('<option data-price="'+a.dataList[b].clothes_price+'" data-dryprice="'+a.dataList[b].clothes_dryprice+'">'+a.dataList[b].clothes_name+"</option>");$("#clotheslist").change(function(){$("#apname").val($(this).find("option:selected").html()),$("#apprice").val($(this).find("option:selected").data("price")),$(".js-washingtype").data("type","0"),$(".js-washingtype").html("\u6e7f\u6d17"),$("#apprice").val($("#clotheslist").find("option:selected").data("price")),$(".js-washingtype").removeClass("btn-primary").addClass("btn-default")})}),$(".js-washingtype").click(function(){"0"==$(this).data("type")?($(this).data("type","1"),$(this).html("\u5e72\u6d17"),$("#apprice").val($("#clotheslist").find("option:selected").data("dryprice")),$(this).removeClass("btn-default").addClass("btn-primary")):($(this).data("type","0"),$(this).html("\u6e7f\u6d17"),$("#apprice").val($("#clotheslist").find("option:selected").data("price")),$(this).removeClass("btn-primary").addClass("btn-default"))}),$('[data-fname="addActProduct"]').click(function(){var a=$("#apname").val(),e=$("#apprice").val(),f=$("#apcolor").val(),g=$("#apremarks").val(),h=$("#apbrand").val(),i=$("#apst").val(),j=$("#apdefect").val(),k=$("#apwashingef").val();if(""===a)return $("#apname").parent().addClass("has-error"),void 0;if($("#apname").parent().removeClass("has-error"),""===e)return $("#apprice").parent().addClass("has-error"),void 0;$("#apprice").parent().removeClass("has-error"),b.push({apname:a,apprice:e,apcolor:f,apremarks:g,apbrand:h,apst:i,apdefect:j,apwashingef:k}),c.find("tbody").append("<tr><td>"+a+'</td><td class="js-apprice">'+e+"</td><td>"+f+"</td><td>"+h+"</td><td>"+i+"</td><td>"+j+"</td><td>"+k+"</td><td>"+g+'</td><td><a class="btn btn-default js-deleteap">\u5220\u9664</a></td></tr>'),d=parseFloat(d).add(e),$("#apname").add("#apprice").add("#apremarks").add("#apcolor").add("#apbrand").add("#apst").add("#apdefect").add("#apwashingef").val(""),$("#apname").focus(),$("#clotheslist").get(0).selectedIndex=0;var l=Number($("#balance").attr("balance")),m=Number($("#discount").html());$("#paid").val(d.mul(m));var n=l.sub(d.mul(m));0>n?$("#balance").css("color","red"):$("#balance").css("color","#333"),$("#balance").html(l+" - "+d.mul(m)+" = "+n),$("#balance").attr("balanceed",n)}),c.on("click",".js-deleteap",function(){var a=$(this).parent().parent(),c=a.index(),e=a.find(".js-apprice").html();a.remove(),b.splice(c,1),d=parseFloat(d).sub(e);var f=Number($("#balance").attr("balance")),g=Number($("#discount").html());$("#paid").val(parseFloat(d).mul(g));var h=f.sub(parseFloat(d).mul(g));0>h?$("#balance").css("color","red"):$("#balance").css("color","#333"),$("#balance").html(f+" - "+parseFloat(d).mul(g)+" = "+h),h=0>h?0:h,$("#balance").attr("balanceed",h)}),$('[data-fname="addBillBtn"]').click(function(){var c=$("#billname").val(),d=$("#username").val(),e=$("#username").attr("uid"),f=$("#uphone").val(),g=$("#paid").val(),h=$("#createdate").val(),i=$("#closingdate").val()?$("#closingdate").val():"\u672a\u7ed3\u8d26",j=$("#remarks").val();if(""===c)return $("#billname").parent().addClass("has-error"),void 0;if($("#billname").parent().removeClass("has-error"),""===d)return $("#username").parent().addClass("has-error"),void 0;if($("#username").parent().removeClass("has-error"),""===f)return $("#uphone").parent().addClass("has-error"),void 0;$("#uphone").parent().removeClass("has-error");var k=0;a.ADO.insert({tname:"bill",tfield:"bill_name,bill_createdate,bill_closingdate,bill_paid,bill_remarks,u_id,a_id",bill_name:c,bill_createdate:h,bill_closingdate:i,bill_paid:g,bill_remarks:j,u_id:e,a_id:$(".js-aid").val()},function(){var d=0;a.ADO.update({tname:"user",idname:"u_id",delid:e,tfield:"u_balance",u_balance:Number($("#balance").attr("balanceed"))},function(){d++});try{a.ADO.select({tname:"bill",conditions:["bill_name="+c,"bill_paid="+g,"u_id="+e]},function(c){k=c.dataList[0].bill_id;for(var e=0;e<b.length;e++)try{console.log("insert:"+b[e].apname),a.ADO.insert({tname:"actproduct",tfield:"ap_name,ap_price,ap_remarks,bill_id,ap_color,ap_st,ap_brand,ap_defect,ap_washingef",ap_name:b[e].apname,ap_price:b[e].apprice,ap_remarks:b[e].apremarks,ap_color:b[e].apcolor,ap_st:b[e].apst,ap_brand:b[e].apbrand,ap_defect:b[e].apdefect,ap_washingef:b[e].apwashingef,bill_id:k},function(){d++})}catch(f){}})}catch(f){}setInterval(function(){d==b.length+1&&($(".js-alertbtn").trigger("click"),setTimeout(function(){window.location.href="http://localhost:8080/xiyi/index.php"},2e3))},800)})})}},b.addActProductObj=addActProductObj}),define("xiyi/tpl/billList",[],function(a,b){billListobj=function(){this.billListHtml='<div class="col-sm-6">                            <div class="col-sm-4">                              <input type="text" class="form-control" id="search" placeholder="\u8bf7\u8f93\u5165\u59d3\u540d\u6216\u8054\u7cfb\u7535\u8bdd">                            </div>                            <div class=" col-sm-2">                              <a data-fname="selectBill" class="btn btn-success">\u641c\u7d22</a>                            </div>                        </div>                        <table class="table table-striped table-hover js-billlist">                        <thead>                          <tr>                            <th>\u9500\u552e\u5355\u53f7</th>                            <th>\u521b\u5efa\u65f6\u95f4</th>                            <th>\u7ed3\u8d26\u65f6\u95f4</th>                            <th>\u91d1\u989d</th>                            <th>\u4f1a\u5458\u59d3\u540d</th>                            <th>\u72b6\u6001</th>                            <th>\u64cd\u4f5c</th>                          </tr>                        </thead>                        <tbody></tbody>                        </table>                        <input class="js-operationbtn" data-target=".bs-operationpanel" data-toggle="modal" type="hidden" />                        <div class="modal fade bs-operationpanel" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">                        <div class="modal-dialog modal-lg">                          <div class="modal-content">                              <div class="modal-header">                                <button data-dismiss="modal" class="close" type="button"><span aria-hidden="true">\xd7</span><span class="sr-only">Close</span></button>                                <h4 id="mySmallModalLabel" class="modal-title">\u9500\u552e\u5355\u8be6\u60c5</h4>                              </div>                              <div class="modal-body js-content">                                <table class="table table-striped table-hover js-actproductlist">                                <thead>                                  <tr>                                    <th>\u8863\u7269\u540d\u79f0</th>                                    <th>\u91d1\u989d(\u5143)</th>                                    <th>\u989c\u8272</th>                                    <th>\u54c1\u724c</th>                                    <th>\u7279\u6b8a\u5904\u7406</th>                                    <th>\u7455\u75b5</th>                                    <th>\u6d17\u540e\u6548\u679c</th>                                    <th>\u5907\u6ce8</th>                                  </tr>                                </thead>                                <tbody></tbody>                                </table>                              </div>                            </div>                        </div>                      </div>                      <a data-start="0" data-count="10" class="js-loadmore btn btn-success col-sm-offset-5">\u52a0\u8f7d\u66f4\u591a</a>',this.$panelbody=$(".js-panel-body"),this.aid=$(".js-aid").val(),this.ADO=new ado},billListobj.prototype={init:function(){var a=this;this.$panelbody.html(this.billListHtml),this.$billlist=$(".js-billlist tbody"),this.$loadmore=$(".js-loadmore"),this.pageCount=parseInt(this.$loadmore.data("count")),a.showBillList(a.getLimit()),a.$loadmore.click(function(){a.showBillList(a.getLimit())})},getLimit:function(){return this.$loadmore.data("start")+","+this.$loadmore.data("count")},showBillList:function(a){var b=this;b.$loadmore.html("\u52a0\u8f7d\u66f4\u591a..."),b.ADO.select({tname:"user,bill",conditions:["user.a_id="+b.aid,"bill.u_id=user.u_id"],limit:a},function(a){for(var c=a.dataList.length,d=0;c>d;d++)b.$billlist.append('<tr><input class="js-billid" value="'+a.dataList[d].bill_id+'" type="hidden" /><input class="js-ubalance" value="'+a.dataList[d].u_balance+'" type="hidden" /><input class="js-userid" value="'+a.dataList[d].u_id+'" type="hidden" /><td>'+a.dataList[d].bill_name+"</td><td>"+a.dataList[d].bill_createdate+'</td><td class="js-closingdate">'+a.dataList[d].bill_closingdate+'</td><td class="js-billpaid">'+a.dataList[d].bill_paid+"</td><td>"+a.dataList[d].u_name+'</td><td><a class="btn btn-default js-billstate">'+a.dataList[d].bill_state+'</a></td><td><a class="btn btn-warning js-checkout">\u7ed3\u8d26</a> <a class="btn btn-info js-showinfo">\u8be6\u60c5</a> <a class="btn btn-danger js-deletebill">\u5220\u9664</a></td></tr>');c==b.pageCount?b.$loadmore.data("start",parseInt(b.$loadmore.data("count"))+parseInt(b.$loadmore.data("start"))):b.$loadmore.hide(),b.$loadmore.html("\u52a0\u8f7d\u66f4\u591a")})}},b.billListobj=billListobj}),define("xiyi/tpl/clothesList",[],function(a,b){clothesListobj=function(){this.clothesListHtml='<div class="col-sm-6">                            <div class="col-sm-3">                              <input type="text" class="form-control" id="yiwuname" placeholder="\u8863\u670d\u540d\u79f0">                            </div>                            <div class="col-sm-3">                              <input type="text" class="form-control" id="shixi" placeholder="\u6e7f\u6d17\u4ef7\u683c">                            </div>                            <div class="col-sm-3">                              <input type="text" class="form-control" id="ganxi" placeholder="\u5e72\u6d17\u4ef7\u683c">                            </div>                            <div class=" col-sm-2">                              <a class="btn btn-success js-addyiwu">\u6dfb\u52a0\u8863\u7269</a>                            </div>                        </div>                        <table class="table table-striped table-hover js-billlist">                        <thead>                          <tr>                            <th>\u540d\u79f0</th>                            <th>\u6e7f\u6d17\u4ef7\u683c</th>                            <th>\u5e72\u6d17\u4ef7\u683c</th>                            <th>\u64cd\u4f5c</th>                          </tr>                        </thead>                        <tbody></tbody>                        </table>                        <input class="js-operationbtn" data-target=".bs-operationpanel" data-toggle="modal" type="hidden" />                        <div class="modal fade bs-operationpanel" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">                        <div class="modal-dialog modal-lg">                          <div class="modal-content">                              <div class="modal-header">                                <button data-dismiss="modal" class="close" type="button"><span aria-hidden="true">\xd7</span><span class="sr-only">Close</span></button>                                <h4 id="mySmallModalLabel" class="modal-title">\u9500\u552e\u5355\u8be6\u60c5</h4>                              </div>                              <div class="modal-body js-content">                              </div>                            </div>                        </div>                      </div>                      <a data-start="0" data-count="50" class="js-loadmore btn btn-success col-sm-offset-5">\u52a0\u8f7d\u66f4\u591a</a>',this.$panelbody=$(".js-panel-body"),this.aid=$(".js-aid").val(),this.ADO=new ado},clothesListobj.prototype={init:function(){var a=this;this.$panelbody.html(this.clothesListHtml),this.$billlist=$(".js-billlist tbody"),this.$loadmore=$(".js-loadmore"),this.pageCount=parseInt(this.$loadmore.data("count")),a.showBillList(),a.$loadmore.click(function(){a.showBillList()}),$("#yiwuname").focus(),$(".js-addyiwu").click(function(){var b=$("#yiwuname").val(),c=$("#shixi").val(),d=$("#ganxi").val();a.ADO.insert({tname:"clothes",tfield:"clothes_name,clothes_price,clothes_dryprice,a_id",clothes_name:b,a_id:a.aid,clothes_price:c,clothes_dryprice:d},function(){a.showBillList()})}),a.$panelbody.on("click",".js-deleteclothes",function(){var b=$(this).parent().parent(),c=b.find(".js-clothesid").val();confirm("\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f")&&a.ADO.remove({tname:"clothes",idname:"clothes_id",ids:c},function(){b.remove()})})},getLimit:function(){return this.$loadmore.data("start")+","+this.$loadmore.data("count")},showBillList:function(){var a=this;a.$loadmore.html("\u52a0\u8f7d\u66f4\u591a..."),a.ADO.select({tname:"admin,clothes",conditions:["admin.a_id="+a.aid,"clothes.a_id=admin.a_id"]},function(b){var c=b.dataList.length;a.$billlist.html("");for(var d=0;c>d;d++)a.$billlist.append('<tr><input class="js-clothesid" value="'+b.dataList[d].clothes_id+'" type="hidden" /><td>'+b.dataList[d].clothes_name+"</td><td>"+b.dataList[d].clothes_price+"</td><td>"+b.dataList[d].clothes_dryprice+'</td><td><a class="btn btn-danger js-deleteclothes">\u5220\u9664</a></td></tr>');c==a.pageCount?a.$loadmore.data("start",parseInt(a.$loadmore.data("count"))+parseInt(a.$loadmore.data("start"))):a.$loadmore.hide(),a.$loadmore.html("\u52a0\u8f7d\u66f4\u591a")})}},b.clothesListobj=clothesListobj}),define("xiyi/tpl/cardList",[],function(a,b){cardListobj=function(){this.clothesListHtml='<div class="col-sm-6">                            <div class="col-sm-3">                              <input type="text" class="form-control" id="yiwuname" placeholder="\u4f1a\u5458\u5361\u540d\u79f0">                            </div>                            <div class="col-sm-3">                              <input type="text" class="form-control" id="shixi" placeholder="\u6298\u6263\u7387(1\u4e3a\u4e0d\u6253\u6298\uff1b0.8\u4e3a\u516b\u6298)">                            </div>                            <div class=" col-sm-2">                              <a class="btn btn-success js-addyiwu">\u6dfb\u52a0\u5361\u7c7b\u578b</a>                            </div>                        </div>                        <table class="table table-striped table-hover js-billlist">                        <thead>                          <tr>                            <th>\u4f1a\u5458\u5361\u540d\u79f0</th>                            <th>\u6298\u6263\u7387</th>                            <th>\u64cd\u4f5c</th>                          </tr>                        </thead>                        <tbody></tbody>                        </table>                        <input class="js-operationbtn" data-target=".bs-operationpanel" data-toggle="modal" type="hidden" />                        <div class="modal fade bs-operationpanel" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">                        <div class="modal-dialog modal-lg">                          <div class="modal-content">                              <div class="modal-header">                                <button data-dismiss="modal" class="close" type="button"><span aria-hidden="true">\xd7</span><span class="sr-only">Close</span></button>                                <h4 id="mySmallModalLabel" class="modal-title">\u9500\u552e\u5355\u8be6\u60c5</h4>                              </div>                              <div class="modal-body js-content">                              </div>                            </div>                        </div>                      </div>                      <a data-start="0" data-count="50" class="js-loadmore btn btn-success col-sm-offset-5">\u52a0\u8f7d\u66f4\u591a</a>',this.$panelbody=$(".js-panel-body"),this.aid=$(".js-aid").val(),this.ADO=new ado},cardListobj.prototype={init:function(){var a=this;this.$panelbody.html(this.clothesListHtml),this.$billlist=$(".js-billlist tbody"),this.$loadmore=$(".js-loadmore"),this.pageCount=parseInt(this.$loadmore.data("count")),a.showBillList(),a.$loadmore.click(function(){a.showBillList()}),$("#yiwuname").focus(),$(".js-addyiwu").click(function(){var b=$("#yiwuname").val(),c=$("#shixi").val();c=c?c:"1",a.ADO.insert({tname:"cardtype",tfield:"cardtype_name,cardtype_discount,a_id",cardtype_name:b,a_id:a.aid,cardtype_discount:c},function(){a.showBillList()})}),a.$panelbody.on("click",".js-deleteclothes",function(){var b=$(this).parent().parent(),c=b.find(".js-clothesid").val();confirm("\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f")&&a.ADO.remove({tname:"cardtype",idname:"cardtype_id",ids:c},function(){b.remove()})}),a.$panelbody.on("click",".js-updateclothes",function(){var b=$(this).parent().parent(),c=b.find(".js-clothesid").val(),d=b.find(".js-discount").val(),e=b.find(".js-cardname").val();a.ADO.update({tname:"cardtype",idname:"cardtype_id",delid:c,tfield:"cardtype_discount,cardtype_name",cardtype_name:e,cardtype_discount:d},function(){alert("\u4fee\u6539\u6210\u529f")})})},getLimit:function(){return this.$loadmore.data("start")+","+this.$loadmore.data("count")},showBillList:function(){var a=this;a.$loadmore.html("\u52a0\u8f7d\u66f4\u591a..."),a.ADO.select({tname:"admin,cardtype",conditions:["admin.a_id="+a.aid,"cardtype.a_id=admin.a_id"]},function(b){var c=b.dataList.length;a.$billlist.html("");for(var d=0;c>d;d++)a.$billlist.append('<tr><input class="js-clothesid" value="'+b.dataList[d].cardtype_id+'" type="hidden" /><td><input class="js-cardname" type="text" value="'+b.dataList[d].cardtype_name+'" /></td><td><input class="js-discount" type="text" value="'+b.dataList[d].cardtype_discount+'" /></td><td><a class="btn btn-danger js-updateclothes">\u4fee\u6539</a> <a class="btn btn-danger js-deleteclothes">\u5220\u9664</a></td></tr>');c==a.pageCount?a.$loadmore.data("start",parseInt(a.$loadmore.data("count"))+parseInt(a.$loadmore.data("start"))):a.$loadmore.hide(),a.$loadmore.html("\u52a0\u8f7d\u66f4\u591a")})}},b.cardListobj=cardListobj});